create role wizard;
create view memview as
select row_id, owner::regrole, descr
from memview_view_scan() v(row_id, dboid, owner, descr)
where dboid = (select oid from pg_database where datname = current_database());
-- Test insert function.
select owner, descr from memview;
 owner | descr 
-------+-------
(0 rows)

select memview_row_insert('wizard'::regrole, 'with magic');
 memview_row_insert 
--------------------
 
(1 row)

select owner, descr from memview;
 owner  |   descr    
--------+------------
 wizard | with magic
(1 row)

select memview_row_insert('wizard'::regrole, 'more magic');
 memview_row_insert 
--------------------
 
(1 row)

select owner, descr from memview;
 owner  |   descr    
--------+------------
 wizard | with magic
 wizard | more magic
(2 rows)

-- Test update function.
select row_id from memview where descr = 'with magic' limit 1 \gset
select memview_row_update(:row_id, 'wizard'::regrole, 'less magic');
 memview_row_update 
--------------------
 
(1 row)

select owner, descr from memview;
 owner  |   descr    
--------+------------
 wizard | less magic
 wizard | more magic
(2 rows)

-- Test delete function. Note that the row id changes since the table
-- is compacted.
select memview_row_delete(:row_id);
 memview_row_delete 
--------------------
 
(1 row)

select owner, descr from memview;
 owner  |   descr    
--------+------------
 wizard | more magic
(1 row)

select memview_row_delete(row_id) from memview;
 memview_row_delete 
--------------------
 
(1 row)

drop view memview;
drop role wizard;
